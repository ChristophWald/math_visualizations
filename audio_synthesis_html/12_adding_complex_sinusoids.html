<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Complex-Sinusoid Synth</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:20px;background:#f9f9f9}
  canvas{border:1px solid #ccc;background:#fff}
  #realCanvas,#imagCanvas{width:1000px;height:150px}
  .slider-container{display:flex;align-items:center;margin-bottom:10px}
  .slider-container label{display:none}
  input[type=range]{width:300px}
  .button-container{margin:20px 0}
  button{margin-right:10px;padding:5px 15px}
</style>
</head>
<body>

<div style="font-weight:bold;margin:0 0 4px">Real Part (blue)</div>
<canvas id="realCanvas"  width="1000" height="150"></canvas>

<div style="font-weight:bold;margin:12px 0 4px">Imaginary Part (purple)</div>
<canvas id="imagCanvas"  width="1000" height="150"></canvas>

<div class="button-container">
  <button onclick="applyPreset('sine')">Sine</button>
  <button onclick="applyPreset('saw')">Saw</button>
  <button onclick="applyPreset('pulse')">Pulse</button>
</div>

<div style="display:flex;align-items:flex-start">
  <div id="sliders" style="min-width:360px"></div>
  <canvas id="spectrumCanvas" width="600" height="300"
          style="margin-left:40px;border:1px solid #ccc;background:#fff"></canvas>
</div>

<script>
/* ─── Parameters ───────────────────────────────────────────── */
const NUM = 15;                         // positive-frequency harmonics
const amps = Array(NUM).fill(0.5);      // initial amplitudes

/* ─── Canvas contexts ──────────────────────────────────────── */
const realCtx = realCanvas.getContext('2d');
const imagCtx = imagCanvas.getContext('2d');
const specCtx = spectrumCanvas.getContext('2d');
const W = realCanvas.width;
const HR = realCanvas.height;
const HI = imagCanvas.height;

/* ─── Build amplitude sliders ──────────────────────────────── */
const slidersDiv = document.getElementById('sliders');
const sliders = [];
for (let k = 0; k < NUM; k++){
  const wrap = document.createElement('div');
  wrap.className = 'slider-container';

  const input = document.createElement('input');
  input.type  = 'range';
  input.min   = 0;
  input.max   = 1;
  input.step  = 0.01;
  input.value = amps[k];
  sliders.push(input);

  input.addEventListener('input', ()=>{
    amps[k] = +input.value;
    drawAll();
  });

  wrap.appendChild(input);
  slidersDiv.appendChild(wrap);
}

/* ─── Spectrum plot (−15 … +15) ───────────────────────────── */
function drawSpectrum(){
  specCtx.clearRect(0,0,spectrumCanvas.width,spectrumCanvas.height);
  const totalBars = NUM*2 + 1;                // −15 … +15
  const barW = spectrumCanvas.width / totalBars;
  const maxAmp = Math.max(...amps,1e-9);

  for (let idx = 0; idx < totalBars; idx++){
    const k = idx - NUM;                      // frequency index
    let amp = 0;
    if (k>0) amp = amps[k-1];
    else if (k<0) amp = amps[-k-1];           // mirror
    // k==0 stays zero

    const h = (amp / maxAmp) * spectrumCanvas.height;
    const x = idx * barW;

    specCtx.fillStyle = '#0077cc';
    specCtx.fillRect(x, spectrumCanvas.height - h, barW - 2, h);

    specCtx.fillStyle = '#444';
    specCtx.font = '10px sans-serif';
    specCtx.fillText(k, x + barW*0.25, spectrumCanvas.height - 4);
  }
}

/* ─── Utility: scale y → canvas coord ─────────────────────── */
function scaler(min,max,canvasH){
  return y => canvasH - ((y - min)/(max - min)) * canvasH;
}

/* ─── Draw both time-domain plots ─────────────────────────── */
function drawAll(){
  /* Find ranges */
  let rMin=Infinity,rMax=-Infinity,iMin=Infinity,iMax=-Infinity;
  const STEPS = 2000;
  for (let p=0;p<=STEPS;p++){
    const x = (p/STEPS)*4*Math.PI;
    let re=0, im=0;
    for (let k=0;k<NUM;k++){
      const n=k+1;
      re += amps[k]*Math.cos(n*x);
      im += amps[k]*Math.sin(n*x);
    }
    if (re<rMin)rMin=re; if(re>rMax)rMax=re;
    if (im<iMin)iMin=im; if(im>iMax)iMax=im;
  }
  if (rMin===rMax){rMin-=1;rMax+=1}
  if (iMin===iMax){iMin-=1;iMax+=1}

  const yReal = scaler(rMin,rMax,HR);
  const yImag = scaler(iMin,iMax,HI);

  /* Real (blue) */
  realCtx.clearRect(0,0,W,HR);
  realCtx.beginPath();
  realCtx.strokeStyle = '#0077cc';     // BLUE for real
  realCtx.lineWidth = 2;

  /* Imag (purple) */
  imagCtx.clearRect(0,0,W,HI);
  imagCtx.beginPath();
  imagCtx.strokeStyle = '#cc0077';     // PURPLE for imag
  imagCtx.lineWidth = 2;

  for (let px=0; px<=W; px++){
    const x = (px/W)*4*Math.PI;
    let re=0, im=0;
    for (let k=0;k<NUM;k++){
      const n=k+1;
      re += amps[k]*Math.cos(n*x);
      im += amps[k]*Math.sin(n*x);
    }
    const yR = yReal(re);
    const yI = yImag(im);
    if(px===0){
      realCtx.moveTo(px,yR);
      imagCtx.moveTo(px,yI);
    }else{
      realCtx.lineTo(px,yR);
      imagCtx.lineTo(px,yI);
    }
  }
  realCtx.stroke();
  imagCtx.stroke();
  drawSpectrum();
}

/* ─── Presets ─────────────────────────────────────────────── */
function applyPreset(type){
  for (let k=0;k<NUM;k++){
    let val=0;
    switch(type){
      case 'sine':  val = (k===0)?1:0; break;
      case 'saw':   val = 1/(k+1);     break;
      case 'pulse': val = ((k+1)&1)? 4/(Math.PI*(k+1)) : 0; break;
    }
    val = Math.abs(val);
    amps[k]=val; sliders[k].value=val;
  }
  drawAll();
}

/* ─── Initial render ─────────────────────────────────────── */
drawAll();
</script>
</body>
</html>

